<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{components/fragments :: head('Employees Management')}">
    <title></title>
</head>

<body>
<div id="app">
    <div th:replace="~{components/fragments :: sidebar}"></div>
    <div id="main">
        <header class="mb-3">
            <a href="#" class="burger-btn d-block d-xl-none">
                <i class="bi bi-justify fs-3"></i>
            </a>
        </header>

        <div class="page-heading">
            <div class="page-title">
                <div class="row">
                    <div class="col-12 col-md-6 order-md-1 order-last">
                        <h3>Employees Management</h3>
                    </div>
                    <div class="col-12 col-md-6 order-md-2 order-first">
                        <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
                                <li class="breadcrumb-item">Employees</li>
                                <li class="breadcrumb-item active" aria-current="page">Management</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
            <section class="section">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">
                            Attendances
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="table1">
                                <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Paid Days off left</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="employee : ${employees}">
                                    <td>
                                        <span th:text="${employee.employeeId}"></span>
                                    </td>
                                    <td>
                                        <span th:text="${employee.name}"></span>
                                    </td>
                                    <td>
                                        <span th:text="${employee.email}"></span>
                                    </td>
                                    <td>
                                        <span th:text="${employee.unusedPaidLeaves} + ' days'"></span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div th:replace="~{components/fragments :: footer}"></div>
    </div>
</div>
<div th:replace="~{components/fragments :: js-libraries}"></div>
<script>
    $(document).ready(function () {
        $('#filter-button').click(function () {
            const emails = [];
            $('#table1 tbody tr').each(function () {
                const email = $(this).find('td:nth-child(3) span').text();
                if (email) {
                    emails.push(email);
                }
            });

            const subject = "Đỗ Quang Huân"

            const content = `<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thông báo Lương và Bảng Chấm Công</title>
</head>
<body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
    <h2 style="color: #2a9d8f;">Thông Báo Về Ngày Nhận Lương</h2>

    <p>Xin chào,</p>

    <p>Chúng tôi xin thông báo rằng hôm nay là ngày nhận lương cho kỳ làm việc vừa qua. Lương đã được chuyển vào tài khoản ngân hàng của bạn. Vui lòng kiểm tra để xác nhận số tiền đã được gửi.</p>

    <h3 style="color: #264653;">Chi tiết:</h3>
    <ul>
        <li><strong>Kỳ làm việc:</strong> 01/10/2024 - 31/10/2024</li>
        <li><strong>Ngày chi trả:</strong> 12/11/2024</li>
        <li><strong>Số tiền:</strong> 15,000,000 VND</li>
    </ul>

    <p>Bên cạnh đó, bảng chấm công của bạn trong kỳ làm việc vừa qua cũng đã được cập nhật. Bạn có thể xem chi tiết bảng chấm công tại hệ thống nội bộ của công ty.</p>

    <p>Hãy kiểm tra kỹ và phản hồi lại cho chúng tôi nếu có bất kỳ thắc mắc nào về số tiền lương hoặc bảng chấm công.</p>

    <p>Chúc bạn một ngày làm việc hiệu quả!</p>

    <p style="margin-top: 30px;">Trân trọng,</p>
    <p><strong>Phòng Nhân Sự</strong><br/>
    Công ty TNHH ABC<br/>
    Điện thoại: 0123 456 789 | Email: hr@company.com</p>
</body>
</html>
`;

            emails.forEach(function (email) {
                $.ajax({
                    url: '/api/employee/v1/send_email',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        recipient: email,
                        subject: subject,
                        content: content
                    }),
                    success: function () {
                        console.log("Email sent to " + email);
                    },
                    error: function () {
                        console.log("Failed to send email to " + email);
                    }
                });
            });
        });
    });
</script>

</body>

</html>